{% extends 'base.html' %}
{% block title %}Reset Employee Password{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 400px;">
    <h3 class="mb-4">Reset Password</h3>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div class="alert alert-success">{{ success }}</div>
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <!-- Step 1: Verify Employee ID + Passcode -->
        {% if not passcode_verified %}
            <div class="mb-3">
                <label for="employee_userid" class="form-label">Employee ID</label>
                <input type="text" name="employee_userid" class="form-control" 
                       value="{{ employee_userid|default:'' }}" required>
            </div>
            <div class="mb-3">
                <label for="passcode" class="form-label">Passcode</label>
                <input type="password" name="passcode" class="form-control" 
                       placeholder="Enter 4-digit passcode" required pattern="\d{4}" maxlength="4">
            </div>
            <button type="submit" name="verify_passcode" class="btn btn-primary">Verify</button>

        <!-- Step 2: Reset Password -->
        {% else %}
            <input type="hidden" name="employee_userid" value="{{ employee_userid }}">
            <div class="mb-3">
                <label for="new_password" class="form-label">New Password</label>
                <input type="password" name="new_password" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="confirm_password" class="form-label">Confirm Password</label>
                <input type="password" name="confirm_password" class="form-control" required>
            </div>
            <button type="submit" name="reset_password" class="btn btn-success">Reset Password</button>
        {% endif %}
    </form>

    <p class="mt-3">
        <a href="{% url 'employee_login_view' %}">Back to Login</a>
    </p>
</div>
{% endblock %}
